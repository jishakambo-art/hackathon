[phases.setup]
nixPkgs = ["python312", "xorg.xvfb"]
aptPkgs = ["libnss3", "libnspr4", "libatk1.0-0", "libatk-bridge2.0-0", "libcups2", "libdrm2", "libxkbcommon0", "libxcomposite1", "libxdamage1", "libxfixes3", "libxrandr2", "libgbm1", "libasound2"]

[phases.install]
cmds = [
    "pip install -r requirements.txt",
    "playwright install chromium",
    "playwright install-deps chromium"
]

[start]
cmd = "sh -c 'Xvfb :99 -screen 0 1024x768x24 -ac +extension GLX +render -noreset & export DISPLAY=:99 && sleep 2 && uvicorn app.main:app --host 0.0.0.0 --port $PORT --loop asyncio --workers 1'"
